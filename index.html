<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Martingale V2 Backtest ‚Äî Binance Real Data</title>
<meta name="description" content="Pine Script Martingale strategy backtester with live Binance data">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><text y='28' font-size='28'>üìä</text></svg>">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body,#root{height:100%;width:100%;overflow:hidden}
body{background:#0A0B0F;color:#D4D6DD;font-family:system-ui,sans-serif}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:#0A0B0F}::-webkit-scrollbar-thumb{background:#2A2D3A;border-radius:2px}
input[type=range]{-webkit-appearance:none;background:#2A2D3A;border-radius:2px;outline:none;height:3px;width:100%}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:12px;height:12px;border-radius:50%;background:#7B5CF5;cursor:pointer}
select{background:#111318;color:#D4D6DD;border:1px solid #1C1F2A;border-radius:6px;padding:6px 8px;font-family:'Courier New',monospace;font-size:11px;outline:none;cursor:pointer}
select:focus{border-color:#7B5CF5}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const{useState,useEffect,useCallback,useRef}=React;
const C={bg:"#0A0B0F",card:"#111318",border:"#1C1F2A",text:"#D4D6DD",muted:"#5C6070",dim:"#2A2D3A",green:"#22C55E",red:"#EF4444",violet:"#7B5CF5",blue:"#3B82F6",amber:"#F59E0B",cyan:"#06B6D4"};
const MN="'Courier New',monospace";

const SYMS=["BTCUSDT","ETHUSDT","SOLUSDT","BNBUSDT","XRPUSDT","DOGEUSDT","ADAUSDT","AVAXUSDT","DOTUSDT","LINKUSDT","MATICUSDT","UNIUSDT","ATOMUSDT","NEARUSDT","LTCUSDT","APTUSDT","ARBUSDT","OPUSDT","SUIUSDT","SEIUSDT","INJUSDT","TIAUSDT","TONUSDT","PEPEUSDT","WIFUSDT","TRXUSDT"];
const TFS=[{l:"15m",v:"15m",n:500},{l:"1h",v:"1h",n:500},{l:"4h",v:"4h",n:500},{l:"1d",v:"1d",n:365},{l:"1w",v:"1w",n:200}];

// ‚îÄ‚îÄ Binance API ‚îÄ‚îÄ
async function fetchK(sym,intv,lim){
  const r=await fetch(`https://api.binance.com/api/v3/klines?symbol=${sym}&interval=${intv}&limit=${lim}`);
  if(!r.ok)throw new Error(`Binance API ${r.status}`);
  return(await r.json()).map((k,i)=>({i,o:+k[1],h:+k[2],l:+k[3],c:+k[4],
    label:new Date(k[0]).toLocaleDateString("tr-TR",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),
    short:new Date(k[0]).toLocaleDateString("tr-TR",{month:"short",day:"numeric"})}));
}

// ‚îÄ‚îÄ Indicators ‚îÄ‚îÄ
function atr(b,x,len){if(x<1)return b[0].h-b[0].l;let s=0,n=0;for(let i=Math.max(1,x-len+1);i<=x;i++){s+=Math.max(b[i].h-b[i].l,Math.abs(b[i].h-b[i-1].c),Math.abs(b[i].l-b[i-1].c));n++;}return n?s/n:b[x].h-b[x].l;}
function ema(b,x,len){const k=2/(len+1);let e=b[0].c;for(let i=1;i<=x;i++)e=b[i].c*k+e*(1-k);return e;}
function rsi(b,x,len=14){if(x<len)return 50;let g=0,lo=0;for(let i=x-len+1;i<=x;i++){const d=b[i].c-b[i-1].c;if(d>0)g+=d;else lo-=d;}return lo===0?100:100-100/(1+g/lo);}

// ‚îÄ‚îÄ Backtest Engine ‚îÄ‚îÄ
function backtest(bars,cfg){
  const{al,man,mA,mP,aL,pD,rOn,rV,eOn}=cfg;const I=10000;
  let cash=I,pos=[],trades=[],eq=[];let peak=I,mDD=0;
  for(let i=1;i<bars.length;i++){
    const p=bars[i].c,a=atr(bars,i,aL),e10=ema(bars,i,10),r=rsi(bars,i);
    const fA=man?mA:a,fT=man?mP:a/pD,eS=eOn?p<e10:true,rO=rOn?r<rV:true;
    const pV=pos.reduce((s,x)=>s+x.q*p,0),curE=cash+pV;
    if(!pos.length&&eS&&rO){const amt=curE*(al[0]/100);if(amt>1&&cash>=amt){pos.push({q:amt/p,ep:p});cash-=amt;}}
    else if(pos.length>0&&pos.length<5){const lE=pos[pos.length-1].ep;if(p<lE-fA&&eS){const e2=cash+pos.reduce((s,x)=>s+x.q*p,0),amt=e2*(al[pos.length]/100);if(amt>1&&cash>=amt){pos.push({q:amt/p,ep:p});cash-=amt;}}}
    if(pos.length>0){const tQ=pos.reduce((s,x)=>s+x.q,0),tC=pos.reduce((s,x)=>s+x.q*x.ep,0),aP=tC/tQ,rE=rOn&&r>rV;
      if(p>=aP+fT||rE){const eV=tQ*p,pnl=eV-tC;trades.push({bar:i,label:bars[i].label,ae:+aP.toFixed(2),ex:+p.toFixed(2),ly:pos.length,pnl:+pnl.toFixed(2),pp:+((pnl/tC)*100).toFixed(2),rs:rE?"RSI":"TP",at:+fA.toFixed(2)});cash+=eV;pos=[];}}
    const cE=cash+pos.reduce((s,x)=>s+x.q*p,0);if(cE>peak)peak=cE;const dd=((peak-cE)/peak)*100;if(dd>mDD)mDD=dd;
    const step=Math.max(1,Math.floor(bars.length/200));
    if(i%step===0||i===bars.length-1)eq.push({i,label:bars[i].short,eq:+cE.toFixed(2),price:p,dd:+dd.toFixed(2),layers:pos.length});
  }
  const fE=cash+pos.reduce((s,x)=>s+x.q*bars[bars.length-1].c,0);
  const w=trades.filter(t=>t.pnl>0),lo=trades.filter(t=>t.pnl<=0);
  const gW=w.reduce((s,t)=>s+t.pnl,0),gL=Math.abs(lo.reduce((s,t)=>s+t.pnl,0));
  return{trades,eq,s:{fE:+fE.toFixed(2),ret:+(((fE-I)/I)*100).toFixed(2),cnt:trades.length,wr:trades.length?+((w.length/trades.length)*100).toFixed(1):0,mDD:+mDD.toFixed(2),pf:gL>0?+(gW/gL).toFixed(2):w.length?999:0,aW:w.length?+(gW/w.length).toFixed(2):0,aL:lo.length?+(-gL/lo.length).toFixed(2):0,aLy:trades.length?+(trades.reduce((s,t)=>s+t.ly,0)/trades.length).toFixed(1):0,oL:pos.length,best:trades.length?+Math.max(...trades.map(t=>t.pnl)).toFixed(2):0,worst:trades.length?+Math.min(...trades.map(t=>t.pnl)).toFixed(2):0}};
}

// ‚îÄ‚îÄ SVG Chart Component ‚îÄ‚îÄ
function Chart({data,dataKey,color,fillColor,refLine,reversed,w=700,h=260}){
  if(!data||!data.length)return null;
  const vals=data.map(d=>d[dataKey]).filter(v=>typeof v==="number");
  if(!vals.length)return null;
  let minV=Math.min(...vals),maxV=Math.max(...vals);
  if(reversed){const t=minV;minV=0;maxV=Math.max(...vals)*1.1;}
  if(maxV===minV){maxV+=1;minV-=1;}
  const pad={t:20,r:60,b:30,l:10};
  const cw=w-pad.l-pad.r,ch=h-pad.t-pad.b;
  const sx=i=>(pad.l+(i/(data.length-1))*cw);
  const sy=v=>reversed?(pad.t+((v-minV)/(maxV-minV))*ch):(pad.t+ch-((v-minV)/(maxV-minV))*ch);
  const pts=data.map((d,i)=>`${sx(i)},${sy(d[dataKey])}`).join(" ");
  const areaPts=pts+` ${sx(data.length-1)},${sy(reversed?minV:minV)} ${sx(0)},${sy(reversed?minV:minV)}`;
  const ticks=5;const yLabels=[];
  for(let i=0;i<=ticks;i++){const v=minV+(maxV-minV)*(i/ticks);yLabels.push({y:sy(v),v:v>=1000?`${(v/1000).toFixed(1)}k`:v.toFixed(v<1?4:v<100?1:0)});}
  const labelStep=Math.floor(data.length/5);
  const xLabels=data.filter((_,i)=>i%labelStep===0).map((d,i)=>({x:sx(i*labelStep),label:d.label}));

  const[hover,setHover]=useState(null);
  const svgRef=useRef(null);
  const onMove=useCallback((e)=>{
    const rect=svgRef.current?.getBoundingClientRect();if(!rect)return;
    const mx=e.clientX-rect.left;const idx=Math.round(((mx-pad.l)/cw)*(data.length-1));
    if(idx>=0&&idx<data.length)setHover(idx);
  },[data,cw,pad.l]);

  return(
    <svg ref={svgRef} width="100%" height={h} viewBox={`0 0 ${w} ${h}`} style={{display:"block"}} onMouseMove={onMove} onMouseLeave={()=>setHover(null)}>
      {/* Grid */}
      {yLabels.map((yl,i)=><line key={i} x1={pad.l} x2={w-pad.r} y1={yl.y} y2={yl.y} stroke={C.border} strokeDasharray="3 6"/>)}
      {/* Y labels */}
      {yLabels.map((yl,i)=><text key={`yt${i}`} x={w-pad.r+5} y={yl.y+4} fill={C.muted} fontSize={9} fontFamily={MN}>{yl.v}</text>)}
      {/* X labels */}
      {xLabels.map((xl,i)=><text key={`xl${i}`} x={xl.x} y={h-5} fill={C.muted} fontSize={8} fontFamily={MN} textAnchor="middle">{xl.label}</text>)}
      {/* Ref line */}
      {refLine!=null&&<><line x1={pad.l} x2={w-pad.r} y1={sy(refLine)} y2={sy(refLine)} stroke={C.dim} strokeDasharray="4 4"/><text x={w-pad.r+5} y={sy(refLine)+4} fill={C.muted} fontSize={8} fontFamily={MN}>${(refLine/1000).toFixed(0)}k</text></>}
      {/* Area fill */}
      {fillColor&&<polygon points={areaPts} fill={fillColor} opacity={0.15}/>}
      {/* Line */}
      <polyline points={pts} fill="none" stroke={color} strokeWidth={2} strokeLinejoin="round"/>
      {/* Hover */}
      {hover!=null&&hover<data.length&&<>
        <line x1={sx(hover)} x2={sx(hover)} y1={pad.t} y2={pad.t+ch} stroke={C.muted} strokeDasharray="2 2" opacity={0.5}/>
        <circle cx={sx(hover)} cy={sy(data[hover][dataKey])} r={4} fill={color} stroke={C.bg} strokeWidth={2}/>
        <rect x={sx(hover)-55} y={pad.t-2} width={110} height={38} rx={4} fill="#181A22" stroke={C.border}/>
        <text x={sx(hover)} y={pad.t+12} fill={C.muted} fontSize={9} fontFamily={MN} textAnchor="middle">{data[hover].label}</text>
        <text x={sx(hover)} y={pad.t+26} fill={color} fontSize={11} fontFamily={MN} textAnchor="middle" fontWeight="bold">
          {dataKey==="price"?"$":""}{data[hover][dataKey].toLocaleString("en",{maximumFractionDigits:2})}{dataKey==="dd"?"%":""}
        </text>
      </>}
    </svg>
  );
}

// ‚îÄ‚îÄ Small UI ‚îÄ‚îÄ
const Stat=({l,v,color,pre="",suf=""})=>(
  <div style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:8,padding:"10px 12px",flex:"1 1 115px",minWidth:100}}>
    <div style={{fontFamily:MN,fontSize:9,color:C.muted,letterSpacing:"0.08em",textTransform:"uppercase",marginBottom:4}}>{l}</div>
    <div style={{fontFamily:MN,fontSize:15,fontWeight:700,color:color||C.text,lineHeight:1.2}}>{pre}{typeof v==="number"?v.toLocaleString("en",{maximumFractionDigits:2}):v}{suf}</div>
  </div>
);
const Sld=({l,v,set,min,max,step=1,suf=""})=>(
  <div style={{marginBottom:9}}>
    <div style={{display:"flex",justifyContent:"space-between",marginBottom:2}}>
      <span style={{fontFamily:MN,fontSize:10,color:C.muted}}>{l}</span>
      <span style={{fontFamily:MN,fontSize:10,color:C.violet}}>{v}{suf}</span>
    </div>
    <input type="range" min={min} max={max} step={step} value={v} onChange={e=>set(+e.target.value)}/>
  </div>
);
const Tog=({l,v,set})=>(
  <label style={{display:"flex",alignItems:"center",gap:6,fontFamily:MN,fontSize:10,color:C.muted,marginBottom:6,cursor:"pointer"}}>
    <div onClick={()=>set(!v)} style={{width:32,height:18,borderRadius:9,background:v?C.violet:C.dim,position:"relative",flexShrink:0,transition:"0.2s"}}>
      <div style={{width:14,height:14,borderRadius:7,background:"#fff",position:"absolute",top:2,left:v?16:2,transition:"0.2s"}}/>
    </div>{l}
  </label>
);

// ‚îÄ‚îÄ MAIN APP ‚îÄ‚îÄ
function App(){
  const[sym,setSym]=useState("ETHUSDT");const[tf,setTf]=useState("1h");
  const[a1,sA1]=useState(10);const[a2,sA2]=useState(15);const[a3,sA3]=useState(20);const[a4,sA4]=useState(25);const[a5,sA5]=useState(30);
  const[man,setMan]=useState(true);const[mA,setMA]=useState(80);const[mP,setMP]=useState(40);
  const[aL,setAL]=useState(14);const[pD,setPD]=useState(2);
  const[rOn,setROn]=useState(false);const[rV,setRV]=useState(71);const[eOn,setEOn]=useState(true);
  const[res,setRes]=useState(null);const[bars,setBars]=useState(null);
  const[tab,setTab]=useState("equity");const[st,setSt]=useState("idle");
  const[lP,setLP]=useState(null);const[err,setErr]=useState(null);const ws=useRef(null);

  const sDef=useCallback((s,t)=>{
    if(!man)return;const m={"15m":0,"1h":1,"4h":2,"1d":3,"1w":4}[t]||1;
    if(s.startsWith("BTC")){setMA([200,500,1500,3000,6000][m]);setMP([100,250,750,1500,3000][m]);}
    else if(s.startsWith("ETH")){setMA([10,30,80,200,500][m]);setMP([5,15,40,100,250][m]);}
    else if(s.startsWith("BNB")){setMA([3,8,20,50,100][m]);setMP([1.5,4,10,25,50][m]);}
    else if(["SOLUSDT","AVAXUSDT","DOTUSDT","LINKUSDT","UNIUSDT","NEARUSDT","APTUSDT","INJUSDT","SUIUSDT"].includes(s)){setMA([0.5,2,5,15,30][m]);setMP([0.25,1,2.5,7,15][m]);}
    else if(["DOGEUSDT","PEPEUSDT","WIFUSDT","SEIUSDT","TRXUSDT","XRPUSDT","ADAUSDT"].includes(s)){setMA([0.002,0.005,0.015,0.04,0.1][m]);setMP([0.001,0.0025,0.007,0.02,0.05][m]);}
    else{setMA([1,3,10,25,60][m]);setMP([0.5,1.5,5,12,30][m]);}
  },[man]);

  const run=useCallback(async()=>{
    setSt("loading");setErr(null);
    try{const d=await fetchK(sym,tf,TFS.find(t=>t.v===tf).n);setBars(d);
      setRes(backtest(d,{al:[a1,a2,a3,a4,a5],man,mA,mP,aL,pD,rOn,rV,eOn}));setSt("done");
    }catch(e){setErr(e.message);setSt("error");}
  },[sym,tf,a1,a2,a3,a4,a5,man,mA,mP,aL,pD,rOn,rV,eOn]);

  useEffect(()=>{if(ws.current)ws.current.close();setLP(null);
    try{const w=new WebSocket(`wss://stream.binance.com:9443/ws/${sym.toLowerCase()}@trade`);w.onmessage=e=>{try{setLP(+parseFloat(JSON.parse(e.data).p).toFixed(4));}catch{}};ws.current=w;}catch{}
    return()=>{if(ws.current)ws.current.close();};
  },[sym]);

  useEffect(()=>{run();},[]);

  const s=res?.s;const rc=s?(s.ret>=0?C.green:C.red):C.text;const aT=a1+a2+a3+a4+a5;

  return(
    <div style={{minHeight:"100vh",background:C.bg,color:C.text,fontFamily:"system-ui,sans-serif"}}>
      {/* HEADER */}
      <div style={{padding:"12px 16px",borderBottom:`1px solid ${C.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:8}}>
        <div>
          <h1 style={{fontFamily:"Georgia,serif",fontSize:18,fontWeight:700}}>Martingale V2 Backtest</h1>
          <p style={{fontFamily:MN,fontSize:9,color:C.muted}}>BINANCE REAL DATA ‚Ä¢ PINE SCRIPT ENGINE</p>
        </div>
        <div style={{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}}>
          {lP&&<div style={{fontFamily:MN,fontSize:13,color:C.green,display:"flex",alignItems:"center",gap:4}}><div style={{width:6,height:6,borderRadius:3,background:C.green,animation:"pulse 2s infinite"}}/>${lP.toLocaleString("en")}</div>}
          <select value={sym} onChange={e=>{setSym(e.target.value);sDef(e.target.value,tf);}}>{SYMS.map(s=><option key={s} value={s}>{s.replace("USDT","/USDT")}</option>)}</select>
          <select value={tf} onChange={e=>{setTf(e.target.value);sDef(sym,e.target.value);}}>{TFS.map(t=><option key={t.v} value={t.v}>{t.l}</option>)}</select>
          <button onClick={run} disabled={st==="loading"} style={{fontFamily:MN,fontSize:10,fontWeight:700,padding:"6px 16px",borderRadius:6,background:st==="loading"?C.dim:C.violet,border:"none",color:"#fff",cursor:st==="loading"?"wait":"pointer"}}>{st==="loading"?"‚è≥":"‚ñ∂ RUN"}</button>
        </div>
      </div>

      {err&&<div style={{margin:"8px 16px",padding:"8px 12px",background:C.red+"15",border:`1px solid ${C.red}33`,borderRadius:6,fontFamily:MN,fontSize:11,color:C.red}}>‚ö† {err}</div>}

      <div style={{display:"flex",height:"calc(100vh - 52px)"}}>
        {/* SIDEBAR */}
        <div style={{width:230,minWidth:230,borderRight:`1px solid ${C.border}`,padding:12,overflowY:"auto"}}>
          <div style={{fontFamily:MN,fontSize:9,color:C.violet,letterSpacing:"0.1em",marginBottom:6,textTransform:"uppercase"}}>Allocation %</div>
          <Sld l="Pos 1" v={a1} set={sA1} min={1} max={50} suf="%"/>
          <Sld l="Pos 2" v={a2} set={sA2} min={1} max={50} suf="%"/>
          <Sld l="Pos 3" v={a3} set={sA3} min={1} max={50} suf="%"/>
          <Sld l="Pos 4" v={a4} set={sA4} min={1} max={50} suf="%"/>
          <Sld l="Pos 5" v={a5} set={sA5} min={1} max={50} suf="%"/>
          <div style={{fontFamily:MN,fontSize:10,color:aT===100?C.green:C.amber,marginBottom:4}}>Total: {aT}%</div>
          <div style={{fontFamily:MN,fontSize:9,color:C.violet,letterSpacing:"0.1em",margin:"8px 0 6px",textTransform:"uppercase"}}>Strategy</div>
          <Tog l="Manual Mode" v={man} set={setMan}/>
          {man?(<>
            <Sld l="APTR (Drop $)" v={mA} set={setMA} min={0.0005} max={8000} step={mA>100?10:mA>10?1:mA>1?0.1:0.001}/>
            <Sld l="Profit Target $" v={mP} set={setMP} min={0.0005} max={4000} step={mP>50?5:mP>5?0.5:mP>0.5?0.05:0.0005}/>
          </>):(<>
            <Sld l="ATR Length" v={aL} set={setAL} min={5} max={50}/>
            <Sld l="Profit Div" v={pD} set={setPD} min={1} max={5} step={0.5}/>
          </>)}
          <div style={{fontFamily:MN,fontSize:9,color:C.violet,letterSpacing:"0.1em",margin:"8px 0 6px",textTransform:"uppercase"}}>Filters</div>
          <Tog l="10 EMA Entry" v={eOn} set={setEOn}/>
          <Tog l="RSI Exit" v={rOn} set={setROn}/>
          {rOn&&<Sld l="RSI" v={rV} set={setRV} min={50} max={90}/>}
          {bars&&<div style={{marginTop:10,padding:8,background:C.bg,borderRadius:6,fontFamily:MN,fontSize:9}}>
            <div style={{color:C.muted,marginBottom:3}}>üìä {sym.replace("USDT","/USDT")} ‚Ä¢ {tf}</div>
            <div style={{color:C.muted}}>{bars.length} candles</div>
            <div style={{color:C.muted}}>{bars[0]?.label} ‚Üí {bars[bars.length-1]?.label}</div>
          </div>}
        </div>

        {/* MAIN */}
        <div style={{flex:1,padding:12,overflowY:"auto"}}>
          {st==="loading"&&<div style={{display:"flex",alignItems:"center",justifyContent:"center",height:300,gap:10}}><div style={{width:20,height:20,border:`2px solid ${C.violet}`,borderTopColor:"transparent",borderRadius:"50%",animation:"spin .8s linear infinite"}}/><span style={{fontFamily:MN,fontSize:12,color:C.muted}}>Binance'den veri √ßekiliyor...</span></div>}

          {s&&st==="done"&&(<>
            {/* STATS */}
            <div style={{display:"flex",flexWrap:"wrap",gap:6,marginBottom:10}}>
              <Stat l="Final Equity" v={s.fE} pre="$" color={rc}/>
              <Stat l="Return" v={s.ret} suf="%" color={rc} pre={s.ret>=0?"+":""}/>
              <Stat l="Win Rate" v={s.wr} suf="%" color={s.wr>=50?C.green:C.red}/>
              <Stat l="Max DD" v={s.mDD} suf="%" color={C.red} pre="-"/>
              <Stat l="Profit Factor" v={s.pf} color={s.pf>=1.5?C.green:s.pf>=1?C.amber:C.red}/>
              <Stat l="Trades" v={s.cnt}/>
              <Stat l="Avg Layers" v={s.aLy} color={C.cyan}/>
              {s.oL>0&&<Stat l="‚ö† Open" v={s.oL} suf=" layers" color={C.amber}/>}
            </div>

            {/* TABS */}
            <div style={{display:"flex",gap:3,marginBottom:8,flexWrap:"wrap"}}>
              {[["equity","üìà Equity"],["drawdown","üìâ Drawdown"],["price","üí∞ Price"],["trades","üìã Trades"]].map(([k,lb])=>(
                <button key={k} onClick={()=>setTab(k)} style={{fontFamily:MN,fontSize:10,padding:"5px 12px",borderRadius:5,background:tab===k?C.violet+"22":"transparent",border:`1px solid ${tab===k?C.violet:C.border}`,color:tab===k?C.violet:C.muted,cursor:"pointer"}}>{lb}</button>
              ))}
            </div>

            {/* CHART / TABLE */}
            <div style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:8,padding:12,marginBottom:10}}>
              {tab==="equity"&&<Chart data={res.eq} dataKey="eq" color={C.violet} fillColor={C.violet} refLine={10000}/>}
              {tab==="drawdown"&&<Chart data={res.eq} dataKey="dd" color={C.red} fillColor={C.red} reversed={true}/>}
              {tab==="price"&&<Chart data={res.eq} dataKey="price" color={C.blue} fillColor={C.blue}/>}
              {tab==="trades"&&<div style={{maxHeight:280,overflowY:"auto"}}>
                <table style={{width:"100%",borderCollapse:"collapse",fontFamily:MN,fontSize:10}}>
                  <thead><tr style={{borderBottom:`1px solid ${C.border}`}}>
                    {["#","Time","Avg Entry","Exit","Layers","ATR","PnL $","PnL %","Type"].map(h=><th key={h} style={{textAlign:"left",padding:"5px 6px",color:C.muted,fontSize:9,fontWeight:600,position:"sticky",top:0,background:C.card}}>{h}</th>)}
                  </tr></thead>
                  <tbody>
                    {res.trades.map((t,i)=>(
                      <tr key={i} style={{borderBottom:`1px solid ${C.border}11`}}>
                        <td style={{padding:"4px 6px",color:C.muted}}>{i+1}</td>
                        <td style={{padding:"4px 6px"}}>{t.label}</td>
                        <td style={{padding:"4px 6px"}}>${t.ae.toLocaleString("en")}</td>
                        <td style={{padding:"4px 6px"}}>${t.ex.toLocaleString("en")}</td>
                        <td style={{padding:"4px 6px",color:C.cyan}}>{t.ly}</td>
                        <td style={{padding:"4px 6px",color:C.muted}}>{t.at}</td>
                        <td style={{padding:"4px 6px",color:t.pnl>=0?C.green:C.red,fontWeight:600}}>{t.pnl>=0?"+":""}{t.pnl.toFixed(2)}</td>
                        <td style={{padding:"4px 6px",color:t.pp>=0?C.green:C.red}}>{t.pp>=0?"+":""}{t.pp}%</td>
                        <td style={{padding:"4px 6px",color:t.rs==="TP"?C.green:C.amber}}>{t.rs}</td>
                      </tr>
                    ))}
                    {!res.trades.length&&<tr><td colSpan={9} style={{padding:20,textAlign:"center",color:C.muted}}>Trade yok ‚Äî APTR/Profit deƒüerlerini ayarlayƒ±n</td></tr>}
                  </tbody>
                </table>
              </div>}
            </div>

            {/* RISK */}
            <div style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:8,padding:12}}>
              <div style={{fontFamily:MN,fontSize:9,color:C.violet,letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:8}}>Risk Analysis</div>
              <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(170px,1fr))",gap:6,fontFamily:MN,fontSize:11}}>
                <div><span style={{color:C.muted}}>Best: </span><span style={{color:C.green,fontWeight:600}}>+${s.best}</span></div>
                <div><span style={{color:C.muted}}>Worst: </span><span style={{color:s.worst<0?C.red:C.text,fontWeight:600}}>${s.worst}</span></div>
                <div><span style={{color:C.muted}}>Avg Win: </span><span style={{color:C.green}}>+${s.aW}</span></div>
                <div><span style={{color:C.muted}}>Avg Loss: </span><span style={{color:C.red}}>${s.aL}</span></div>
                <div><span style={{color:C.muted}}>R:R: </span><span style={{fontWeight:600}}>{s.aL!==0?Math.abs(s.aW/s.aL).toFixed(2):"‚àû"}</span></div>
                <div><span style={{color:C.muted}}>Mode: </span><span>{man?`Manual ($${mA}/$${mP})`:`ATR(${aL})/${pD}`}</span></div>
                <div><span style={{color:C.muted}}>Verdict: </span><span style={{fontWeight:700,color:s.ret>0&&s.mDD<25&&s.pf>1.2?C.green:s.ret>0?C.amber:C.red}}>{s.ret>0&&s.mDD<25&&s.pf>1.2?"‚úÖ Viable":s.ret>0?"‚ö†Ô∏è Risky":"‚ùå Unprofitable"}</span></div>
              </div>
            </div>
          </>)}
          {st==="idle"&&<div style={{display:"flex",alignItems:"center",justifyContent:"center",height:300,color:C.muted,fontFamily:MN}}>‚ñ∂ RUN ile ba≈ülayƒ±n</div>}
        </div>
      </div>
    </div>
  );
}
ReactDOM.render(React.createElement(App),document.getElementById('root'));
</script>
</body>
</html>
